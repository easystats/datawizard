<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Compute group-meaned and de-meaned variables — demean • datawizard</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet"><link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet"><link href="../deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compute group-meaned and de-meaned variables — demean"><meta name="description" content="demean() computes group- and de-meaned versions of a variable that can be
used in regression analysis to model the between- and within-subject effect
(person-mean centering or centering within clusters). degroup() is more
generic in terms of the centering-operation. While demean() always uses
mean-centering, degroup() can also use the mode or median for centering."><meta property="og:description" content="demean() computes group- and de-meaned versions of a variable that can be
used in regression analysis to model the between- and within-subject effect
(person-mean centering or centering within clusters). degroup() is more
generic in terms of the centering-operation. While demean() always uses
mean-centering, degroup() can also use the mode or median for centering."><meta property="og:image" content="https://easystats.github.io/datawizard/reference/figures/card.png"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@easystats4u"><meta name="twitter:site" content="@easystats4u"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">datawizard</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html" aria-label="Reference"><span class="fa fa-file-code"></span> Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html" aria-label="Articles"><span class="fa fa-book-reader"></span> Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html" aria-label="News"><span class="fa fa-newspaper"></span> News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-easystats" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="easystats"><span class="fa fab fa-r-project"></span> easystats</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-easystats"><li><a class="external-link dropdown-item" href="https://easystats.github.io/bayestestR/">bayestestR</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/correlation/">correlation</a></li>
    <li><a class="dropdown-item" href="https://easystats.github.io/datawizard/">datawizard</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/easystats/">easystats</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/effectsize/">effectsize</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/insight/">insight</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/modelbased/">modelbased</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/performance/">performance</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/parameters/">parameters</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/report/">report</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/see/">see</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="http://twitter.com/easystats4u" aria-label="Twitter"><span class="fa fa-twitter"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/easystats/datawizard/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Compute group-meaned and de-meaned variables</h1>
      <small class="dont-index">Source: <a href="https://github.com/easystats/datawizard/blob/main/R/demean.R" class="external-link"><code>R/demean.R</code></a></small>
      <div class="d-none name"><code>demean.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>demean()</code> computes group- and de-meaned versions of a variable that can be
used in regression analysis to model the between- and within-subject effect
(person-mean centering or centering within clusters). <code>degroup()</code> is more
generic in terms of the centering-operation. While <code>demean()</code> always uses
mean-centering, <code>degroup()</code> can also use the mode or median for centering.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">demean</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">select</span>,</span>
<span>  <span class="va">by</span>,</span>
<span>  nested <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  suffix_demean <span class="op">=</span> <span class="st">"_within"</span>,</span>
<span>  suffix_groupmean <span class="op">=</span> <span class="st">"_between"</span>,</span>
<span>  append <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  add_attributes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">degroup</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">select</span>,</span>
<span>  <span class="va">by</span>,</span>
<span>  nested <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  center <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  suffix_demean <span class="op">=</span> <span class="st">"_within"</span>,</span>
<span>  suffix_groupmean <span class="op">=</span> <span class="st">"_between"</span>,</span>
<span>  append <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  add_attributes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">detrend</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">select</span>,</span>
<span>  <span class="va">by</span>,</span>
<span>  nested <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  center <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  suffix_demean <span class="op">=</span> <span class="st">"_within"</span>,</span>
<span>  suffix_groupmean <span class="op">=</span> <span class="st">"_between"</span>,</span>
<span>  append <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  add_attributes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A data frame.</p></dd>


<dt id="arg-select">select<a class="anchor" aria-label="anchor" href="#arg-select"></a></dt>
<dd><p>Character vector (or formula) with names of variables to select
that should be group- and de-meaned.</p></dd>


<dt id="arg-by">by<a class="anchor" aria-label="anchor" href="#arg-by"></a></dt>
<dd><p>Character vector (or formula) with the name of the variable that
indicates the group- or cluster-ID. For cross-classified or nested designs,
<code>by</code> can also identify two or more variables as group- or cluster-IDs. If
the data is nested and should be treated as such, set <code>nested = TRUE</code>. Else,
if <code>by</code> defines two or more variables and <code>nested = FALSE</code>, a cross-classified
design is assumed. Note that <code>demean()</code> and <code>degroup()</code> can't handle a mix
of nested and cross-classified designs in one model.</p>
<p>For nested designs, <code>by</code> can be:</p><ul><li><p>a character vector with the name of the variable that indicates the
levels, ordered from <em>highest</em> level to <em>lowest</em> (e.g.
<code>by = c("L4", "L3", "L2")</code>.</p></li>
<li><p>a character vector with variable names in the format <code>by = "L4/L3/L2"</code>,
where the levels are separated by <code>/</code>.</p></li>
</ul><p>See also section <em>De-meaning for cross-classified designs</em> and
<em>De-meaning for nested designs</em> below.</p></dd>


<dt id="arg-nested">nested<a class="anchor" aria-label="anchor" href="#arg-nested"></a></dt>
<dd><p>Logical, if <code>TRUE</code>, the data is treated as nested. If <code>FALSE</code>,
the data is treated as cross-classified. Only applies if <code>by</code> contains more
than one variable.</p></dd>


<dt id="arg-suffix-demean-suffix-groupmean">suffix_demean, suffix_groupmean<a class="anchor" aria-label="anchor" href="#arg-suffix-demean-suffix-groupmean"></a></dt>
<dd><p>String value, will be appended to the
names of the group-meaned and de-meaned variables of <code>x</code>. By default,
de-meaned variables will be suffixed with <code>"_within"</code> and
grouped-meaned variables with <code>"_between"</code>.</p></dd>


<dt id="arg-append">append<a class="anchor" aria-label="anchor" href="#arg-append"></a></dt>
<dd><p>Logical, if <code>TRUE</code> (default), the group- and de-meaned
variables will be appended (column bind) to the original data <code>x</code>,
thus returning both the original and the de-/group-meaned variables.</p></dd>


<dt id="arg-add-attributes">add_attributes<a class="anchor" aria-label="anchor" href="#arg-add-attributes"></a></dt>
<dd><p>Logical, if <code>TRUE</code>, the returned variables gain
attributes to indicate the within- and between-effects. This is only
relevant when printing <code>model_parameters()</code> - in such cases, the
within- and between-effects are printed in separated blocks.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Toggle warnings and messages.</p></dd>


<dt id="arg-center">center<a class="anchor" aria-label="anchor" href="#arg-center"></a></dt>
<dd><p>Method for centering. <code>demean()</code> always performs
mean-centering, while <code>degroup()</code> can use <code>center = "median"</code> or
<code>center = "mode"</code> for median- or mode-centering, and also <code>"min"</code>
or <code>"max"</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data frame with the group-/de-meaned variables, which get the suffix
<code>"_between"</code> (for the group-meaned variable) and <code>"_within"</code> (for the
de-meaned variable) by default. For cross-classified or nested designs,
the name pattern of the group-meaned variables is the name of the centered
variable followed by the name of the variable that indicates the related
grouping level, e.g. <code>predictor_L3_between</code> and <code>predictor_L2_between</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="heterogeneity-bias">Heterogeneity Bias<a class="anchor" aria-label="anchor" href="#heterogeneity-bias"></a></h2>



<p>Mixed models include different levels of sources of variability, i.e.
error terms at each level. When macro-indicators (or level-2 predictors,
or higher-level units, or more general: <em>group-level predictors that
<strong>vary</strong> within and across groups</em>) are included as fixed effects (i.e.
treated as covariate at level-1), the variance that is left unaccounted for
this covariate will be absorbed into the error terms of level-1 and level-2
(<em>Bafumi and Gelman 2006; Gelman and Hill 2007, Chapter 12.6.</em>):
"Such covariates contain two parts: one that is specific to the higher-level
entity that does not vary between occasions, and one that represents the
difference between occasions, within higher-level entities" (<em>Bell et al. 2015</em>).
Hence, the error terms will be correlated with the covariate, which violates
one of the assumptions of mixed models (iid, independent and identically
distributed error terms). This bias is also called the <em>heterogeneity bias</em>
(<em>Bell et al. 2015</em>). To resolve this problem, level-2 predictors used as
(level-1) covariates should be separated into their "within" and "between"
effects by "de-meaning" and "group-meaning": After demeaning time-varying
predictors, "at the higher level, the mean term is no longer constrained by
Level 1 effects, so it is free to account for all the higher-level variance
associated with that variable" (<em>Bell et al. 2015</em>).</p>
    </div>
    <div class="section level2">
    <h2 id="panel-data-and-correlating-fixed-and-group-effects">Panel data and correlating fixed and group effects<a class="anchor" aria-label="anchor" href="#panel-data-and-correlating-fixed-and-group-effects"></a></h2>



<p><code>demean()</code> is intended to create group- and de-meaned variables for panel
regression models (fixed effects models), or for complex
random-effect-within-between models (see <em>Bell et al. 2015, 2018</em>), where
group-effects (random effects) and fixed effects correlate (see
<em>Bafumi and Gelman 2006</em>). This can happen, for instance, when analyzing
panel data, which can lead to <em>Heterogeneity Bias</em>. To control for correlating
predictors and group effects, it is recommended to include the group-meaned
and de-meaned version of <em>time-varying covariates</em> (and group-meaned version
of <em>time-invariant covariates</em> that are on a higher level, e.g. level-2
predictors) in the model. By this, one can fit complex multilevel models for
panel data, including time-varying predictors, time-invariant predictors and
random effects.</p>
    </div>
    <div class="section level2">
    <h2 id="why-mixed-models-are-preferred-over-fixed-effects-models">Why mixed models are preferred over fixed effects models<a class="anchor" aria-label="anchor" href="#why-mixed-models-are-preferred-over-fixed-effects-models"></a></h2>



<p>A mixed models approach can model the causes of endogeneity explicitly
by including the (separated) within- and between-effects of time-varying
fixed effects and including time-constant fixed effects. Furthermore,
mixed models also include random effects, thus a mixed models approach
is superior to classic fixed-effects models, which lack information of
variation in the group-effects or between-subject effects. Furthermore,
fixed effects regression cannot include random slopes, which means that
fixed effects regressions are neglecting "cross-cluster differences in the
effects of lower-level controls (which) reduces the precision of estimated
context effects, resulting in unnecessarily wide confidence intervals and
low statistical power" (<em>Heisig et al. 2017</em>).</p>
    </div>
    <div class="section level2">
    <h2 id="terminology">Terminology<a class="anchor" aria-label="anchor" href="#terminology"></a></h2>



<p>The group-meaned variable is simply the mean of an independent variable
within each group (or id-level or cluster) represented by <code>by</code>. It represents
the cluster-mean of an independent variable. The regression coefficient of a
group-meaned variable is the <em>between-subject-effect</em>. The de-meaned variable
is then the centered version of the group-meaned variable. De-meaning is
sometimes also called person-mean centering or centering within clusters.
The regression coefficient of a de-meaned variable represents the
<em>within-subject-effect</em>.</p>
    </div>
    <div class="section level2">
    <h2 id="de-meaning-with-continuous-predictors">De-meaning with continuous predictors<a class="anchor" aria-label="anchor" href="#de-meaning-with-continuous-predictors"></a></h2>



<p>For continuous time-varying predictors, the recommendation is to include
both their de-meaned and group-meaned versions as fixed effects, but not
the raw (untransformed) time-varying predictors themselves. The de-meaned
predictor should also be included as random effect (random slope). In
regression models, the coefficient of the de-meaned predictors indicates
the within-subject effect, while the coefficient of the group-meaned
predictor indicates the between-subject effect.</p>
    </div>
    <div class="section level2">
    <h2 id="de-meaning-with-binary-predictors">De-meaning with binary predictors<a class="anchor" aria-label="anchor" href="#de-meaning-with-binary-predictors"></a></h2>



<p>For binary time-varying predictors, there are two recommendations. First
is to include the raw (untransformed) binary predictor as fixed effect
only and the <em>de-meaned</em> variable as random effect (random slope).
The alternative would be to add the de-meaned version(s) of binary
time-varying covariates as additional fixed effect as well (instead of
adding it as random slope). Centering time-varying binary variables to
obtain within-effects (level 1) isn't necessary. They have a sensible
interpretation when left in the typical 0/1 format (<em>Hoffmann 2015,
chapter 8-2.I</em>). <code>demean()</code> will thus coerce categorical time-varying
predictors to numeric to compute the de- and group-meaned versions for
these variables, where the raw (untransformed) binary predictor and the
de-meaned version should be added to the model.</p>
    </div>
    <div class="section level2">
    <h2 id="de-meaning-of-factors-with-more-than-levels">De-meaning of factors with more than 2 levels<a class="anchor" aria-label="anchor" href="#de-meaning-of-factors-with-more-than-levels"></a></h2>



<p>Factors with more than two levels are demeaned in two ways: first, these
are also converted to numeric and de-meaned; second, dummy variables
are created (binary, with 0/1 coding for each level) and these binary
dummy-variables are de-meaned in the same way (as described above).
Packages like <strong>panelr</strong> internally convert factors to dummies before
demeaning, so this behaviour can be mimicked here.</p>
    </div>
    <div class="section level2">
    <h2 id="de-meaning-interaction-terms">De-meaning interaction terms<a class="anchor" aria-label="anchor" href="#de-meaning-interaction-terms"></a></h2>



<p>There are multiple ways to deal with interaction terms of within- and
between-effects.</p><ul><li><p>A classical approach is to simply use the product term of the de-meaned
variables (i.e. introducing the de-meaned variables as interaction term
in the model formula, e.g. <code>y ~ x_within * time_within</code>). This approach,
however, might be subject to bias (see <em>Giesselmann &amp; Schmidt-Catran 2020</em>).</p></li>
<li><p>Another option is to first calculate the product term and then apply the
de-meaning to it. This approach produces an estimator "that reflects
unit-level differences of interacted variables whose moderators vary
within units", which is desirable if <em>no</em> within interaction of
two time-dependent variables is required. This is what <code>demean()</code> does
internally when <code>select</code> contains interaction terms.</p></li>
<li><p>A third option, when the interaction should result in a genuine within
estimator, is to "double de-mean" the interaction terms
(<em>Giesselmann &amp; Schmidt-Catran 2018</em>), however, this is currently
not supported by <code>demean()</code>. If this is required, the <code>wmb()</code>
function from the <strong>panelr</strong> package should be used.</p></li>
</ul><p>To de-mean interaction terms for within-between models, simply specify
the term as interaction for the <code>select</code>-argument, e.g. <code>select = "a*b"</code>
(see 'Examples').</p>
    </div>
    <div class="section level2">
    <h2 id="de-meaning-for-cross-classified-designs">De-meaning for cross-classified designs<a class="anchor" aria-label="anchor" href="#de-meaning-for-cross-classified-designs"></a></h2>



<p><code>demean()</code> can handle cross-classified designs, where the data has two or
more groups at the higher (i.e. second) level. In such cases, the
<code>by</code>-argument can identify two or more variables that represent the
cross-classified group- or cluster-IDs. The de-meaned variables for
cross-classified designs are simply subtracting all group means from each
individual value, i.e. <em>fully cluster-mean-centering</em> (see <em>Guo et al. 2024</em>
for details). Note that de-meaning for cross-classified designs is <em>not</em>
equivalent to de-meaning of nested data structures from models with three or
more levels. Set <code>nested = TRUE</code> to explicitly assume a nested design. For
cross-classified designs, de-meaning is supposed to work for models like
<code>y ~ x + (1|level3) + (1|level2)</code>, but <em>not</em> for models like
<code>y ~ x + (1|level3/level2)</code>. Note that <code>demean()</code> and <code>degroup()</code> can't
handle a mix of nested and cross-classified designs in one model.</p>
    </div>
    <div class="section level2">
    <h2 id="de-meaning-for-nested-designs">De-meaning for nested designs<a class="anchor" aria-label="anchor" href="#de-meaning-for-nested-designs"></a></h2>



<p><em>Brincks et al. (2017)</em> have suggested an algorithm to center variables for
nested designs, which is implemented in <code>demean()</code>. For nested designs, set
<code>nested = TRUE</code> <em>and</em> specify the variables that indicate the different
levels in descending order in the <code>by</code> argument. E.g.,
<code>by = c("level4", "level3, "level2")</code> assumes a model like
<code>y ~ x + (1|level4/level3/level2)</code>. An alternative notation for the
<code>by</code>-argument would be <code>by = "level4/level3/level2"</code>, similar to the
formula notation.</p>
    </div>
    <div class="section level2">
    <h2 id="analysing-panel-data-with-mixed-models-using-lme-">Analysing panel data with mixed models using lme4<a class="anchor" aria-label="anchor" href="#analysing-panel-data-with-mixed-models-using-lme-"></a></h2>



<p>A description of how to translate the formulas described in <em>Bell et al. 2018</em>
into R using <code>lmer()</code> from <strong>lme4</strong> can be found in
<a href="https://easystats.github.io/parameters/articles/demean.html" class="external-link">this vignette</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<ul><li><p>Bafumi J, Gelman A. 2006. Fitting Multilevel Models When Predictors
and Group Effects Correlate. In. Philadelphia, PA: Annual meeting of the
American Political Science Association.</p></li>
<li><p>Bell A, Fairbrother M, Jones K. 2019. Fixed and Random Effects
Models: Making an Informed Choice. Quality &amp; Quantity (53); 1051-1074</p></li>
<li><p>Bell A, Jones K. 2015. Explaining Fixed Effects: Random Effects
Modeling of Time-Series Cross-Sectional and Panel Data. Political Science
Research and Methods, 3(1), 133–153.</p></li>
<li><p>Brincks, A. M., Enders, C. K., Llabre, M. M., Bulotsky-Shearer, R. J.,
Prado, G., and Feaster, D. J. (2017). Centering Predictor Variables in
Three-Level Contextual Models. Multivariate Behavioral Research, 52(2),
149–163. https://doi.org/10.1080/00273171.2016.1256753</p></li>
<li><p>Gelman A, Hill J. 2007. Data Analysis Using Regression and
Multilevel/Hierarchical Models. Analytical Methods for Social Research.
Cambridge, New York: Cambridge University Press</p></li>
<li><p>Giesselmann M, Schmidt-Catran, AW. 2020. Interactions in fixed
effects regression models. Sociological Methods &amp; Research, 1–28.
https://doi.org/10.1177/0049124120914934</p></li>
<li><p>Guo Y, Dhaliwal J, Rights JD. 2024. Disaggregating level-specific effects
in cross-classified multilevel models. Behavior Research Methods, 56(4),
3023–3057.</p></li>
<li><p>Heisig JP, Schaeffer M, Giesecke J. 2017. The Costs of Simplicity:
Why Multilevel Models May Benefit from Accounting for Cross-Cluster
Differences in the Effects of Controls. American Sociological Review 82
(4): 796–827.</p></li>
<li><p>Hoffman L. 2015. Longitudinal analysis: modeling within-person
fluctuation and change. New York: Routledge</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>If grand-mean centering (instead of centering within-clusters)
is required, see <code><a href="center.html">center()</a></code>. See <code><a href="https://easystats.github.io/performance/reference/check_group_variation.html" class="external-link">performance::check_group_variation()</a></code>
to check for heterogeneity bias.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">iris</span><span class="op">$</span><span class="va">ID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># fake-ID</span></span></span>
<span class="r-in"><span><span class="va">iris</span><span class="op">$</span><span class="va">binary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">150</span>, <span class="fl">1</span>, <span class="fl">.35</span><span class="op">)</span><span class="op">)</span> <span class="co"># binary variable</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">demean</span><span class="op">(</span><span class="va">iris</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sepal.Length"</span>, <span class="st">"Petal.Length"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sepal.Length Sepal.Width Petal.Length Petal.Width Species ID binary</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          5.1         3.5          1.4         0.2  setosa  2      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2          4.9         3.0          1.4         0.2  setosa  2      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3          4.7         3.2          1.3         0.2  setosa  3      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4          4.6         3.1          1.5         0.2  setosa  4      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          5.0         3.6          1.4         0.2  setosa  4      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6          5.4         3.9          1.7         0.4  setosa  2      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sepal.Length_between Petal.Length_between Sepal.Length_within</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1             5.681579             3.434211          -0.5815789</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2             5.681579             3.434211          -0.7815789</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3             5.789189             3.451351          -1.0891892</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4             5.748718             3.684615          -1.1487179</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5             5.748718             3.684615          -0.7487179</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6             5.681579             3.434211          -0.2815789</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Petal.Length_within</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1           -2.034211</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           -2.034211</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           -2.151351</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4           -2.184615</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5           -2.284615</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6           -1.734211</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">demean</span><span class="op">(</span><span class="va">iris</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sepal.Length"</span>, <span class="st">"binary"</span>, <span class="st">"Species"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Categorical predictors (binary, Species) have been coerced to numeric</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   values to compute de- and group-meaned variables.</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sepal.Length Sepal.Width Petal.Length Petal.Width Species ID binary</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          5.1         3.5          1.4         0.2  setosa  2      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2          4.9         3.0          1.4         0.2  setosa  2      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3          4.7         3.2          1.3         0.2  setosa  3      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4          4.6         3.1          1.5         0.2  setosa  4      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          5.0         3.6          1.4         0.2  setosa  4      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6          5.4         3.9          1.7         0.4  setosa  2      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sepal.Length_between binary_between Species_between Species_setosa_between</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1             5.681579      0.4473684       0.8947368              0.4210526</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2             5.681579      0.4473684       0.8947368              0.4210526</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3             5.789189      0.2432432       0.8648649              0.4324324</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4             5.748718      0.2307692       0.9487179              0.2820513</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5             5.748718      0.2307692       0.9487179              0.2820513</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6             5.681579      0.4473684       0.8947368              0.4210526</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Species_versicolor_between Species_virginica_between Sepal.Length_within</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                  0.2631579                 0.3157895          -0.5815789</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                  0.2631579                 0.3157895          -0.7815789</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3                  0.2702703                 0.2972973          -1.0891892</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4                  0.4871795                 0.2307692          -1.1487179</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5                  0.4871795                 0.2307692          -0.7487179</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6                  0.2631579                 0.3157895          -0.2815789</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   binary_within Species_within Species_setosa_within Species_versicolor_within</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    -0.4473684     -0.8947368             0.5789474                -0.2631579</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2    -0.4473684     -0.8947368             0.5789474                -0.2631579</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     0.7567568     -0.8648649             0.5675676                -0.2702703</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4    -0.2307692     -0.9487179             0.7179487                -0.4871795</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5    -0.2307692     -0.9487179             0.7179487                -0.4871795</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6    -0.4473684     -0.8947368             0.5789474                -0.2631579</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Species_virginica_within</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1               -0.3157895</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2               -0.3157895</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3               -0.2972973</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4               -0.2307692</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5               -0.2307692</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6               -0.3157895</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># demean interaction term x*y</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">demean</span><span class="op">(</span><span class="va">dat</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"x*y"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   a x y ID a_between x_y_between   a_within x_y_within</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 1 4 1  1  2.666667    4.666667 -1.6666667 -0.6666667</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 2 3 2  2  2.333333    4.000000 -0.3333333  2.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 3 3 1  3  2.500000    4.500000  0.5000000 -1.5000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 4 4 2  1  2.666667    4.666667  1.3333333  3.3333333</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 1 1 4  2  2.333333    4.000000 -1.3333333  0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 2 2 3  3  2.500000    4.500000 -0.5000000  1.5000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 3 1 2  1  2.666667    4.666667  0.3333333 -2.6666667</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8 4 2 1  2  2.333333    4.000000  1.6666667 -2.0000000</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># or in formula-notation</span></span></span>
<span class="r-in"><span><span class="fu">demean</span><span class="op">(</span><span class="va">dat</span>, select <span class="op">=</span> <span class="op">~</span> <span class="va">a</span> <span class="op">+</span> <span class="va">x</span> <span class="op">*</span> <span class="va">y</span>, by <span class="op">=</span> <span class="op">~</span><span class="va">ID</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   a x y ID a_between x_y_between   a_within x_y_within</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 1 4 1  1  2.666667    4.666667 -1.6666667 -0.6666667</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 2 3 2  2  2.333333    4.000000 -0.3333333  2.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 3 3 1  3  2.500000    4.500000  0.5000000 -1.5000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 4 4 2  1  2.666667    4.666667  1.3333333  3.3333333</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 1 1 4  2  2.333333    4.000000 -1.3333333  0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 2 2 3  3  2.500000    4.500000 -0.5000000  1.5000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 3 1 2  1  2.666667    4.666667  0.3333333 -2.6666667</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8 4 2 1  2  2.333333    4.000000  1.6666667 -2.0000000</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://sites.google.com/site/indrajeetspatilmorality/" class="external-link">Indrajeet Patil</a>, <a href="https://www.etiennebacher.com/" class="external-link">Etienne Bacher</a>, <a href="https://dominiquemakowski.github.io/" class="external-link">Dominique Makowski</a>, <a href="https://github.com/strengejacke" class="external-link">Daniel Lüdecke</a>, <a href="https://home.msbstats.info/" class="external-link">Mattan S. Ben-Shachar</a>, <a href="https://wiernik.org/" class="external-link">Brenton M. Wiernik</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000.</p>
</div>

    </footer></div>





  </body></html>

