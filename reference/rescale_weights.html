<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Most functions to fit multilevel and mixed effects models only
allow to specify frequency weights, but not design (i.e. sampling or
probability) weights, which should be used when analyzing complex samples
and survey data. rescale_weights() implements an algorithm proposed
by Asparouhov (2006) and Carle (2009) to rescale design
weights in survey data to account for the grouping structure of multilevel
models, which then can be used for multilevel modelling."><title>Rescale design weights for multilevel analysis — rescale_weights • datawizard</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.2/font.css" rel="stylesheet"><link href="../deps/JetBrains_Mono-0.4.2/font.css" rel="stylesheet"><link href="../deps/Roboto_Slab-0.4.2/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Rescale design weights for multilevel analysis — rescale_weights"><meta property="og:description" content="Most functions to fit multilevel and mixed effects models only
allow to specify frequency weights, but not design (i.e. sampling or
probability) weights, which should be used when analyzing complex samples
and survey data. rescale_weights() implements an algorithm proposed
by Asparouhov (2006) and Carle (2009) to rescale design
weights in survey data to account for the grouping structure of multilevel
models, which then can be used for multilevel modelling."><meta property="og:image" content="https://easystats.github.io/datawizard/reference/figures/card.png"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@easystats4u"><meta name="twitter:site" content="@easystats4u"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">datawizard</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.3.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html" aria-label="Reference">
    <span class="fa fa fa fa-file-code"></span>
     
    Reference
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/index.html" aria-label="Articles">
    <span class="fa fa fa fa-book-reader"></span>
     
    Articles
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html" aria-label="News">
    <span class="fa fa fa fa-newspaper"></span>
     
    News
  </a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--easystats" aria-label="easystats">
    <span class="fab fa fab fa-r-project"></span>
     
    easystats
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--easystats">
    <a class="external-link dropdown-item" href="https://easystats.github.io/bayestestR/">bayestestR</a>
    <a class="external-link dropdown-item" href="https://easystats.github.io/correlation/">correlation</a>
    <a class="dropdown-item" href="https://easystats.github.io/datawizard/">datawizard</a>
    <a class="external-link dropdown-item" href="https://easystats.github.io/easystats/">easystats</a>
    <a class="external-link dropdown-item" href="https://easystats.github.io/effectsize/">effectsize</a>
    <a class="external-link dropdown-item" href="https://easystats.github.io/insight/">insight</a>
    <a class="external-link dropdown-item" href="https://easystats.github.io/modelbased/">modelbased</a>
    <a class="external-link dropdown-item" href="https://easystats.github.io/performance/">performance</a>
    <a class="external-link dropdown-item" href="https://easystats.github.io/parameters/">parameters</a>
    <a class="external-link dropdown-item" href="https://easystats.github.io/report/">report</a>
    <a class="external-link dropdown-item" href="https://easystats.github.io/see/">see</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="http://twitter.com/easystats4u" aria-label="Twitter">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/easystats/datawizard/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Rescale design weights for multilevel analysis</h1>
      <small class="dont-index">Source: <a href="https://github.com/easystats/datawizard/blob/HEAD/R/rescale_weights.R" class="external-link"><code>R/rescale_weights.R</code></a></small>
      <div class="d-none name"><code>rescale_weights.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Most functions to fit multilevel and mixed effects models only
allow to specify frequency weights, but not design (i.e. sampling or
probability) weights, which should be used when analyzing complex samples
and survey data. <code>rescale_weights()</code> implements an algorithm proposed
by <cite>Asparouhov (2006)</cite> and <cite>Carle (2009)</cite> to rescale design
weights in survey data to account for the grouping structure of multilevel
models, which then can be used for multilevel modelling.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">rescale_weights</span><span class="op">(</span><span class="va">data</span>, <span class="va">group</span>, <span class="va">probability_weights</span>, nest <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>A data frame.</p></dd>


<dt>group</dt>
<dd><p>Variable names (as character vector, or as formula), indicating
the grouping structure (strata) of the survey data (level-2-cluster
variable). It is also possible to create weights for multiple group
variables; in such cases, each created weighting variable will be suffixed
by the name of the group variable.</p></dd>


<dt>probability_weights</dt>
<dd><p>Variable indicating the probability (design or
sampling) weights of the survey data (level-1-weight).</p></dd>


<dt>nest</dt>
<dd><p>Logical, if <code>TRUE</code> and <code>group</code> indicates at least two
group variables, then groups are "nested", i.e. groups are now a
combination from each group level of the variables in <code>group</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p><code>data</code>, including the new weighting variables: <code>pweights_a</code></p>


<p>and <code>pweights_b</code>, which represent the rescaled design weights to use
in multilevel models (use these variables for the <code>weights</code> argument).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Rescaling is based on two methods: For <code>pweights_a</code>, the sample weights
<code>probability_weights</code> are adjusted by a factor that represents the proportion
of group size divided by the sum of sampling weights within each group. The
adjustment factor for <code>pweights_b</code> is the sum of sample weights within each
group divided by the sum of squared sample weights within each group (see
Carle (2009), Appendix B). In other words, <code>pweights_a</code> "scales the weights
so that the new weights sum to the cluster sample size" while <code>pweights_b</code>
"scales the weights so that the new weights sum to the effective cluster
size".</p>
<p>Regarding the choice between scaling methods A and B, Carle suggests that
"analysts who wish to discuss point estimates should report results based on
weighting method A. For analysts more interested in residual between-group
variance, method B may generally provide the least biased estimates". In
general, it is recommended to fit a non-weighted model and weighted models
with both scaling methods and when comparing the models, see whether the
"inferential decisions converge", to gain confidence in the results.</p>
<p>Though the bias of scaled weights decreases with increasing group size,
method A is preferred when insufficient or low group size is a concern.</p>
<p>The group ID and probably PSU may be used as random effects (e.g. nested
design, or group and PSU as varying intercepts), depending on the survey
design that should be mimicked.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    
<ul><li><p>Carle A.C. (2009). Fitting multilevel models in complex survey data
with design weights: Recommendations. BMC Medical Research Methodology
9(49): 1-13</p></li>
<li><p>Asparouhov T. (2006). General Multi-Level Modeling with Sampling
Weights. Communications in Statistics - Theory and Methods 35: 439-460</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/lme4/lme4/" class="external-link">"lme4"</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">nhanes_sample</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">rescale_weights</span><span class="op">(</span><span class="va">nhanes_sample</span>, <span class="st">"SDMVSTRA"</span>, <span class="st">"WTINT2YR"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># also works with multiple group-variables</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">rescale_weights</span><span class="op">(</span><span class="va">nhanes_sample</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SDMVSTRA"</span>, <span class="st">"SDMVPSU"</span><span class="op">)</span>, <span class="st">"WTINT2YR"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># or nested structures.</span></span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">rescale_weights</span><span class="op">(</span></span></span>
<span class="r-in"><span>    data <span class="op">=</span> <span class="va">nhanes_sample</span>,</span></span>
<span class="r-in"><span>    group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SDMVSTRA"</span>, <span class="st">"SDMVPSU"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    probability_weights <span class="op">=</span> <span class="st">"WTINT2YR"</span>,</span></span>
<span class="r-in"><span>    nest <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">nhanes_sample</span> <span class="op">&lt;-</span> <span class="fu">rescale_weights</span><span class="op">(</span><span class="va">nhanes_sample</span>, <span class="st">"SDMVSTRA"</span>, <span class="st">"WTINT2YR"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/glmer.html" class="external-link">glmer</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">total</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">RIAGENDR</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">RIDRETH1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">SDMVPSU</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    data <span class="op">=</span> <span class="va">nhanes_sample</span>,</span></span>
<span class="r-in"><span>    weights <span class="op">=</span> <span class="va">pweights_a</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: lme4</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: Matrix</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Generalized linear mixed model fit by maximum likelihood (Laplace</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Approximation) [glmerMod]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Family: poisson  ( log )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: total ~ factor(RIAGENDR) * (log(age) + factor(RIDRETH1)) + (1 |  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     SDMVPSU)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Data: nhanes_sample</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Weights: pweights_a</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       AIC       BIC    logLik  deviance  df.resid </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  78844.27  78920.47 -39409.14  78818.27      2582 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Random effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Groups  Name        Std.Dev.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  SDMVPSU (Intercept) 0.1018  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of obs: 2595, groups:  SDMVPSU, 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed Effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         (Intercept)                    factor(RIAGENDR)2  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                            2.491802                            -1.021306  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                            log(age)                    factor(RIDRETH1)2  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                            0.838725                            -0.088629  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   factor(RIDRETH1)3                    factor(RIDRETH1)4  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                           -0.013332                             0.722511  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   factor(RIDRETH1)5           factor(RIAGENDR)2:log(age)  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                           -0.106521                            -1.012695  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(RIAGENDR)2:factor(RIDRETH1)2  factor(RIAGENDR)2:factor(RIDRETH1)3  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                           -0.009089                             0.732983  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(RIAGENDR)2:factor(RIDRETH1)4  factor(RIAGENDR)2:factor(RIDRETH1)5  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                            0.275963                             0.542073  </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://sites.google.com/site/indrajeetspatilmorality/" class="external-link">Indrajeet Patil</a>, <a href="https://dominiquemakowski.github.io/" class="external-link">Dominique Makowski</a>, <a href="https://github.com/strengejacke" class="external-link">Daniel Lüdecke</a>, <a href="https://home.msbstats.info/" class="external-link">Mattan S. Ben-Shachar</a>, <a href="https://wiernik.org/" class="external-link">Brenton M. Wiernik</a>, <a href="https://www.etiennebacher.com/" class="external-link">Etienne Bacher</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.9000.</p>
</div>

    </footer></div>

  

  

  </body></html>

